<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TypeScript 高级类型 |  </title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.a5aa8a4f.css" as="style"><link rel="preload" href="/assets/js/app.50b0bd0e.js" as="script"><link rel="preload" href="/assets/js/6.e87d9ed0.js" as="script"><link rel="preload" href="/assets/js/1.ec164ee9.js" as="script"><link rel="preload" href="/assets/js/44.c67cec05.js" as="script"><link rel="prefetch" href="/assets/js/10.f31dcad4.js"><link rel="prefetch" href="/assets/js/100.b65dbfb7.js"><link rel="prefetch" href="/assets/js/101.2f7804d4.js"><link rel="prefetch" href="/assets/js/102.19721495.js"><link rel="prefetch" href="/assets/js/103.3907d09f.js"><link rel="prefetch" href="/assets/js/104.6dc0d50d.js"><link rel="prefetch" href="/assets/js/105.8fc03431.js"><link rel="prefetch" href="/assets/js/106.2b3e80bb.js"><link rel="prefetch" href="/assets/js/107.00eeb0c1.js"><link rel="prefetch" href="/assets/js/108.6684f665.js"><link rel="prefetch" href="/assets/js/109.31599187.js"><link rel="prefetch" href="/assets/js/11.b3d0a7d3.js"><link rel="prefetch" href="/assets/js/110.110aebcc.js"><link rel="prefetch" href="/assets/js/111.41b6043b.js"><link rel="prefetch" href="/assets/js/112.efbffe48.js"><link rel="prefetch" href="/assets/js/113.ecb80c23.js"><link rel="prefetch" href="/assets/js/114.687d4b44.js"><link rel="prefetch" href="/assets/js/115.e370fa4f.js"><link rel="prefetch" href="/assets/js/116.323e724e.js"><link rel="prefetch" href="/assets/js/117.0ad5ef95.js"><link rel="prefetch" href="/assets/js/118.943466be.js"><link rel="prefetch" href="/assets/js/119.cffe859f.js"><link rel="prefetch" href="/assets/js/12.8ef5f3e8.js"><link rel="prefetch" href="/assets/js/120.d7e16a57.js"><link rel="prefetch" href="/assets/js/121.f551d960.js"><link rel="prefetch" href="/assets/js/122.2d19b98d.js"><link rel="prefetch" href="/assets/js/123.1c21f20a.js"><link rel="prefetch" href="/assets/js/124.b6b80c3a.js"><link rel="prefetch" href="/assets/js/125.59e4c603.js"><link rel="prefetch" href="/assets/js/126.a8118a06.js"><link rel="prefetch" href="/assets/js/127.e3a59b59.js"><link rel="prefetch" href="/assets/js/128.b7a37475.js"><link rel="prefetch" href="/assets/js/129.f0a3bd3b.js"><link rel="prefetch" href="/assets/js/13.6a90eae7.js"><link rel="prefetch" href="/assets/js/130.421ae976.js"><link rel="prefetch" href="/assets/js/131.f4c0fb70.js"><link rel="prefetch" href="/assets/js/132.525fac8e.js"><link rel="prefetch" href="/assets/js/133.5ae9ce44.js"><link rel="prefetch" href="/assets/js/134.95c2addc.js"><link rel="prefetch" href="/assets/js/135.dcacde31.js"><link rel="prefetch" href="/assets/js/136.d667ea7a.js"><link rel="prefetch" href="/assets/js/137.19b2ce8c.js"><link rel="prefetch" href="/assets/js/138.390429cb.js"><link rel="prefetch" href="/assets/js/139.c70b8ece.js"><link rel="prefetch" href="/assets/js/14.38618b9e.js"><link rel="prefetch" href="/assets/js/140.e5036082.js"><link rel="prefetch" href="/assets/js/141.7bfa2b08.js"><link rel="prefetch" href="/assets/js/142.e77dd390.js"><link rel="prefetch" href="/assets/js/143.8eb9154d.js"><link rel="prefetch" href="/assets/js/144.9767ec98.js"><link rel="prefetch" href="/assets/js/145.9e9c6701.js"><link rel="prefetch" href="/assets/js/146.ca4d12d0.js"><link rel="prefetch" href="/assets/js/147.da4e4bae.js"><link rel="prefetch" href="/assets/js/148.a21442de.js"><link rel="prefetch" href="/assets/js/149.bc249c71.js"><link rel="prefetch" href="/assets/js/15.8d4afe36.js"><link rel="prefetch" href="/assets/js/150.88c28b26.js"><link rel="prefetch" href="/assets/js/151.f46342e7.js"><link rel="prefetch" href="/assets/js/152.7b34cc5a.js"><link rel="prefetch" href="/assets/js/153.8c2f5dff.js"><link rel="prefetch" href="/assets/js/154.cb99ba1d.js"><link rel="prefetch" href="/assets/js/155.7f280a85.js"><link rel="prefetch" href="/assets/js/156.a86bb026.js"><link rel="prefetch" href="/assets/js/157.4391bcec.js"><link rel="prefetch" href="/assets/js/158.87a031d9.js"><link rel="prefetch" href="/assets/js/159.c23f4f61.js"><link rel="prefetch" href="/assets/js/16.d0096911.js"><link rel="prefetch" href="/assets/js/160.1b0ed9ef.js"><link rel="prefetch" href="/assets/js/161.21fb4a61.js"><link rel="prefetch" href="/assets/js/162.cc0391bb.js"><link rel="prefetch" href="/assets/js/163.d086c8b9.js"><link rel="prefetch" href="/assets/js/164.ec1fada9.js"><link rel="prefetch" href="/assets/js/165.0d293c44.js"><link rel="prefetch" href="/assets/js/166.8d66cec9.js"><link rel="prefetch" href="/assets/js/167.09c4b555.js"><link rel="prefetch" href="/assets/js/168.848e9a5a.js"><link rel="prefetch" href="/assets/js/169.a1a11dcf.js"><link rel="prefetch" href="/assets/js/17.87f12011.js"><link rel="prefetch" href="/assets/js/170.339f38b1.js"><link rel="prefetch" href="/assets/js/171.c92805e4.js"><link rel="prefetch" href="/assets/js/172.1e00ee49.js"><link rel="prefetch" href="/assets/js/173.bfcc3ae9.js"><link rel="prefetch" href="/assets/js/174.14665670.js"><link rel="prefetch" href="/assets/js/175.20f36a90.js"><link rel="prefetch" href="/assets/js/176.6081bc4d.js"><link rel="prefetch" href="/assets/js/177.9ef42251.js"><link rel="prefetch" href="/assets/js/178.9ed7eb1c.js"><link rel="prefetch" href="/assets/js/179.dfe3224a.js"><link rel="prefetch" href="/assets/js/18.08d0ada2.js"><link rel="prefetch" href="/assets/js/180.ca1b88dd.js"><link rel="prefetch" href="/assets/js/181.85fd587e.js"><link rel="prefetch" href="/assets/js/182.7dec60e9.js"><link rel="prefetch" href="/assets/js/183.ae99194d.js"><link rel="prefetch" href="/assets/js/184.a14fa938.js"><link rel="prefetch" href="/assets/js/185.5f4317e4.js"><link rel="prefetch" href="/assets/js/186.e4c20829.js"><link rel="prefetch" href="/assets/js/187.ad7aba45.js"><link rel="prefetch" href="/assets/js/188.51585f42.js"><link rel="prefetch" href="/assets/js/189.eef9c3af.js"><link rel="prefetch" href="/assets/js/19.f3670cbe.js"><link rel="prefetch" href="/assets/js/190.55ec796f.js"><link rel="prefetch" href="/assets/js/191.8af62975.js"><link rel="prefetch" href="/assets/js/192.f510c242.js"><link rel="prefetch" href="/assets/js/193.27739c1f.js"><link rel="prefetch" href="/assets/js/194.27ce2340.js"><link rel="prefetch" href="/assets/js/195.84027b6d.js"><link rel="prefetch" href="/assets/js/196.df11c94c.js"><link rel="prefetch" href="/assets/js/197.f23f9af1.js"><link rel="prefetch" href="/assets/js/198.884fdd82.js"><link rel="prefetch" href="/assets/js/199.8be019b7.js"><link rel="prefetch" href="/assets/js/20.8e38aad3.js"><link rel="prefetch" href="/assets/js/200.a0f74bb9.js"><link rel="prefetch" href="/assets/js/201.b8cab5b2.js"><link rel="prefetch" href="/assets/js/202.593bcdf1.js"><link rel="prefetch" href="/assets/js/203.38ada156.js"><link rel="prefetch" href="/assets/js/204.5e8e0d74.js"><link rel="prefetch" href="/assets/js/205.2f37d4c7.js"><link rel="prefetch" href="/assets/js/206.1e95b0c1.js"><link rel="prefetch" href="/assets/js/207.7b33e430.js"><link rel="prefetch" href="/assets/js/208.586fb54f.js"><link rel="prefetch" href="/assets/js/209.0f76a189.js"><link rel="prefetch" href="/assets/js/21.7c0af6e5.js"><link rel="prefetch" href="/assets/js/210.a03e7aa4.js"><link rel="prefetch" href="/assets/js/22.a43e198e.js"><link rel="prefetch" href="/assets/js/23.edc63186.js"><link rel="prefetch" href="/assets/js/24.6acb4524.js"><link rel="prefetch" href="/assets/js/25.54b2d8c1.js"><link rel="prefetch" href="/assets/js/26.a6a7d99e.js"><link rel="prefetch" href="/assets/js/27.d562aaf3.js"><link rel="prefetch" href="/assets/js/28.bd34de62.js"><link rel="prefetch" href="/assets/js/29.7e560460.js"><link rel="prefetch" href="/assets/js/3.cbfd3302.js"><link rel="prefetch" href="/assets/js/30.9e4eb3a0.js"><link rel="prefetch" href="/assets/js/31.dc5c15a7.js"><link rel="prefetch" href="/assets/js/32.ea74517c.js"><link rel="prefetch" href="/assets/js/33.1e12504d.js"><link rel="prefetch" href="/assets/js/34.899cdc10.js"><link rel="prefetch" href="/assets/js/35.a417ea04.js"><link rel="prefetch" href="/assets/js/36.9be6f5b5.js"><link rel="prefetch" href="/assets/js/37.a92c1c1a.js"><link rel="prefetch" href="/assets/js/38.f08a12ba.js"><link rel="prefetch" href="/assets/js/39.aeba8fcb.js"><link rel="prefetch" href="/assets/js/4.221b21e6.js"><link rel="prefetch" href="/assets/js/40.59634b4d.js"><link rel="prefetch" href="/assets/js/41.bbe49b53.js"><link rel="prefetch" href="/assets/js/42.ba2e0d89.js"><link rel="prefetch" href="/assets/js/43.f1c4dea3.js"><link rel="prefetch" href="/assets/js/45.adb75bb8.js"><link rel="prefetch" href="/assets/js/46.95713282.js"><link rel="prefetch" href="/assets/js/47.9cd0cbcb.js"><link rel="prefetch" href="/assets/js/48.5d1125de.js"><link rel="prefetch" href="/assets/js/49.bd152b52.js"><link rel="prefetch" href="/assets/js/5.94a481b2.js"><link rel="prefetch" href="/assets/js/50.bd44ae39.js"><link rel="prefetch" href="/assets/js/51.b845484b.js"><link rel="prefetch" href="/assets/js/52.9f5e1b33.js"><link rel="prefetch" href="/assets/js/53.b82c5ca1.js"><link rel="prefetch" href="/assets/js/54.13dbf8b8.js"><link rel="prefetch" href="/assets/js/55.5951115e.js"><link rel="prefetch" href="/assets/js/56.21e28602.js"><link rel="prefetch" href="/assets/js/57.6d17fbd1.js"><link rel="prefetch" href="/assets/js/58.1f664d30.js"><link rel="prefetch" href="/assets/js/59.baa7e5ae.js"><link rel="prefetch" href="/assets/js/60.9b3f768f.js"><link rel="prefetch" href="/assets/js/61.ca432034.js"><link rel="prefetch" href="/assets/js/62.fcd5505e.js"><link rel="prefetch" href="/assets/js/63.e3e719f4.js"><link rel="prefetch" href="/assets/js/64.90f57282.js"><link rel="prefetch" href="/assets/js/65.4b3403d2.js"><link rel="prefetch" href="/assets/js/66.cec94f4b.js"><link rel="prefetch" href="/assets/js/67.979fb1ae.js"><link rel="prefetch" href="/assets/js/68.4655356e.js"><link rel="prefetch" href="/assets/js/69.ebac3cde.js"><link rel="prefetch" href="/assets/js/7.967c5e84.js"><link rel="prefetch" href="/assets/js/70.292403ea.js"><link rel="prefetch" href="/assets/js/71.cf3e7135.js"><link rel="prefetch" href="/assets/js/72.7b9c4dd4.js"><link rel="prefetch" href="/assets/js/73.8b0d3568.js"><link rel="prefetch" href="/assets/js/74.2a2a861a.js"><link rel="prefetch" href="/assets/js/75.25094287.js"><link rel="prefetch" href="/assets/js/76.baac8a99.js"><link rel="prefetch" href="/assets/js/77.3b641027.js"><link rel="prefetch" href="/assets/js/78.a01fd402.js"><link rel="prefetch" href="/assets/js/79.c86cd94e.js"><link rel="prefetch" href="/assets/js/8.80ca7005.js"><link rel="prefetch" href="/assets/js/80.f41c03e8.js"><link rel="prefetch" href="/assets/js/81.fa9db5b5.js"><link rel="prefetch" href="/assets/js/82.d878db34.js"><link rel="prefetch" href="/assets/js/83.2355ce47.js"><link rel="prefetch" href="/assets/js/84.b01be280.js"><link rel="prefetch" href="/assets/js/85.15df55fa.js"><link rel="prefetch" href="/assets/js/86.d1dd2952.js"><link rel="prefetch" href="/assets/js/87.1c5e3ca6.js"><link rel="prefetch" href="/assets/js/88.ad05de6d.js"><link rel="prefetch" href="/assets/js/89.60ab9921.js"><link rel="prefetch" href="/assets/js/9.15a9f0c5.js"><link rel="prefetch" href="/assets/js/90.0436c4c7.js"><link rel="prefetch" href="/assets/js/91.575612f5.js"><link rel="prefetch" href="/assets/js/92.9a654a18.js"><link rel="prefetch" href="/assets/js/93.e442b473.js"><link rel="prefetch" href="/assets/js/94.808f7829.js"><link rel="prefetch" href="/assets/js/95.e9a6e5a2.js"><link rel="prefetch" href="/assets/js/96.c46e7d83.js"><link rel="prefetch" href="/assets/js/97.39d336e3.js"><link rel="prefetch" href="/assets/js/98.168f8272.js"><link rel="prefetch" href="/assets/js/99.f2314237.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a5aa8a4f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc> </h3> <p class="description" data-v-4e82dffc data-v-4e82dffc></p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <span data-v-4e82dffc>2017 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt=" " class="logo"> <span class="site-name"> </span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/accumulate/javascript/basicsGrammar.html" class="nav-link"><i class="undefined"></i>
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/advanced/guide/scss.html" class="nav-link"><i class="undefined"></i>
  前端进阶
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/docs/koa/koarapid/rapid.html" class="nav-link"><i class="iconfont reco-date"></i>
  Koa
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      我的
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <!----> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>156</h3> <h6 data-v-828910c6>Articles</h6></div> <div data-v-828910c6><h3 data-v-828910c6>6</h3> <h6 data-v-828910c6>Tags</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/accumulate/javascript/basicsGrammar.html" class="nav-link"><i class="undefined"></i>
  前端基础
</a></li><li class="dropdown-item"><!----> <a href="/docs/advanced/guide/scss.html" class="nav-link"><i class="undefined"></i>
  前端进阶
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/docs/koa/koarapid/rapid.html" class="nav-link"><i class="iconfont reco-date"></i>
  Koa
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-account"></i>
      我的
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML+CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>TypeScript</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/advanced/typeScript/introduction.html" class="sidebar-link">TypeScript基本入门</a></li><li><a href="/docs/advanced/typeScript/type.html" class="sidebar-link">TypeScript数据类型</a></li><li><a href="/docs/advanced/typeScript/port.html" class="sidebar-link">TypeScript接口使用</a></li><li><a href="/docs/advanced/typeScript/functionType.html" class="sidebar-link">TypeScript函数类型</a></li><li><a href="/docs/advanced/typeScript/genericity.html" class="sidebar-link">TypeScript泛型使用</a></li><li><a href="/docs/advanced/typeScript/class.html" class="sidebar-link">TypeScript中的类</a></li><li><a href="/docs/advanced/typeScript/assert.html" class="sidebar-link">TypeScript类型断言、类型保护、类型判断</a></li><li><a href="/docs/advanced/typeScript/compatibility.html" class="sidebar-link">TypeScript类型兼容性</a></li><li><a href="/docs/advanced/typeScript/advancedType.html" aria-current="page" class="active sidebar-link">TypeScript高级类型</a></li><li><a href="/docs/advanced/typeScript/decorator.html" class="sidebar-link">TypeScript装饰器</a></li><li><a href="/docs/advanced/typeScript/modularization.html" class="sidebar-link">TypeScript模块化</a></li><li><a href="/docs/advanced/typeScript/statement.html" class="sidebar-link">TypeScript声明合并和混入</a></li><li><a href="/docs/advanced/typeScript/write.html" class="sidebar-link">TypeScript书写声明文件</a></li><li><a href="/docs/advanced/typeScript/axios.html" class="sidebar-link">TypeScript封装Axios</a></li><li><a href="/docs/advanced/typeScript/promise.html" class="sidebar-link">Promise及语法糖async和await</a></li><li><a href="/docs/advanced/typeScript/react.html" class="sidebar-link">TypeScript与React实战</a></li><li><a href="/docs/advanced/typeScript/tslint.html" class="sidebar-link">TSLint 配置</a></li><li><a href="/docs/advanced/typeScript/eslint.html" class="sidebar-link">ESlint配置</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端业务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端可视化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器工作原理</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端性能优化</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc></h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><!---->
            
          <span data-v-4e82dffc>2017 - </span>
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page" style="padding-right:0;"><section><div class="page-title"><h1 class="title">TypeScript 高级类型</h1> <div data-v-1ff7123e><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="typescript-高级类型"><a href="#typescript-高级类型" class="header-anchor">#</a> TypeScript 高级类型</h1> <h3 id="本文概览"><a href="#本文概览" class="header-anchor">#</a> 本文概览：</h3> <p><img src="/assets/img/1607611689847-7d51d28e-af4a-40c9-961e-6068a24940ed.826d5d5a.png" alt="img"></p> <h2 id="_1-交叉类型"><a href="#_1-交叉类型" class="header-anchor">#</a> 1. 交叉类型</h2> <p>交叉类型是将多个类型合并为一个类型。 这让我们可以把现有的多种类型叠加到一起成为一种类型，它包含了所需的所有类型的特性。</p> <p>在 JavaScript 中，混入是一种非常常见的模式，在这种模式中，可以将两个对象中创建一个新对象，新对象会拥有这两个对象所有的功能。</p> <p>交叉类型可以让我们安全的使用此种模式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> mixin<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>first<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> second<span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token constant">U</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">&amp;</span> <span class="token constant">U</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> id <span class="token keyword">in</span> first<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span>result<span class="token punctuation">)</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> first<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> id <span class="token keyword">in</span> second<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token constant">U</span><span class="token operator">&gt;</span>result<span class="token punctuation">)</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> second<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token string">'hello'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> b<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 现在 x 拥有了 a 属性与 b 属性</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> x<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> x<span class="token punctuation">.</span>b<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h2 id="_2-联合类型"><a href="#_2-联合类型" class="header-anchor">#</a> 2. 联合类型</h2> <p>在 JavaScript 中，我们希望属性为多种类型之一，如字符串或者数组。这时联合类型就派上用场了（它使用 | 作为标记，如 string | number）。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">formatCommandline</span><span class="token punctuation">(</span><span class="token parameter">command<span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> line <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> command <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    line <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    line <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>联合类型表示一个值可以是几种类型之一，用竖线 | 分隔每个类型，所以 number | string | boolean 表示一个值可以是number、string、或boolean。</p> <h2 id="_3-字面量类型"><a href="#_3-字面量类型" class="header-anchor">#</a> 3. 字面量类型</h2> <p>字面量类型可能也算不上是高级类型，但是字符串字面量类型和字符串类型其实并不一样，下面来看一下它们有什么区别。</p> <h3 id="_1-字符串字面量类型"><a href="#_1-字符串字面量类型" class="header-anchor">#</a> （1）字符串字面量类型</h3> <p>字符串字面量类型其实就是字符串常量，与字符串类型不同的是它是具体的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Name <span class="token operator">=</span> <span class="token string">&quot;TS&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> name1<span class="token operator">:</span> Name <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span> <span class="token comment">// error 不能将类型&quot;test&quot;分配给类型&quot;TS&quot;</span>
<span class="token keyword">const</span> name2<span class="token operator">:</span> Name <span class="token operator">=</span> <span class="token string">&quot;TS&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>还可以使用联合类型来使用多个字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Direction <span class="token operator">=</span> <span class="token string">&quot;north&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;east&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;south&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;west&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getDirectionFirstLetter</span><span class="token punctuation">(</span><span class="token parameter">direction<span class="token operator">:</span> Direction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> direction<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getDirectionFirstLetter</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error 类型“&quot;test&quot;”的参数不能赋给类型“Direction”的参数</span>
<span class="token function">getDirectionFirstLetter</span><span class="token punctuation">(</span><span class="token string">&quot;east&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-数字字面量类型"><a href="#_2-数字字面量类型" class="header-anchor">#</a> （2）数字字面量类型</h3> <p>除了字符串字面量类型还有数字字面量类型，它和字符串字面量类型差不多，都是指定类型为具体的值。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">:</span> Age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> info<span class="token operator">:</span> Info <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;TS&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">28</span> <span class="token comment">// error 不能将类型“28”分配给类型“18”</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>来看一个比较经典的逻辑错误：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">||</span> index <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// error This condition will always return 'true' since the types '0' and '1' have no overlap</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在判断逻辑处使用了 <code>||</code> 符，当 index !== 0 不成立时，说明 index 就是 0，则不应该再判断 index 是否不等于 1；而如果 index !== 0 成立，那后面的判断也不会再执行；所以这个地方会报错。</p> <h2 id="_4-索引类型"><a href="#_4-索引类型" class="header-anchor">#</a> 4. 索引类型</h2> <p>先来看一个场景，现在需要一个 pick 函数，这个函数可以从对象上取出指定的属性，在 JavaScript 中这个函数应该是这样的:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">pick</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> names</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果从一个 <code>user</code> 对象中取出 id ，那么应该这样:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
    username<span class="token operator">:</span> <span class="token string">'Jessica Lee'</span><span class="token punctuation">,</span>
    id<span class="token operator">:</span> <span class="token number">460000201904141743</span><span class="token punctuation">,</span>
    token<span class="token operator">:</span> <span class="token string">'460000201904141743'</span><span class="token punctuation">,</span>
    avatar<span class="token operator">:</span> <span class="token string">'http://dummyimage.com/200x200'</span><span class="token punctuation">,</span>
    role<span class="token operator">:</span> <span class="token string">'vip'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">pick</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// [ '460000201904141743' ]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>那如何在 TypeScript 中实现上述函数？</p> <p>pick 函数的第一个参数 <code>o</code> 可以使用可索引类型，这个对象的 key 都是 <code>string</code> 而对应的值可能是任意类型，那么可以这样表示:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Obj</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> any
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>第二个参数 <code>names</code> 很明显是个字符串数组：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">pick</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token operator">:</span> Obj<span class="token punctuation">,</span> names<span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这样写定义不够严谨：</p> <ul><li>参数 <code>names</code> 的成员应该是参数 <code>o</code> 的属性，因此不应该是 string 这种宽泛的定义，应该更加准确</li> <li>pick 函数的返回值类型为 <code>any[]</code>，其实可以更加精准，pick 的返回值类型应该是所取的属性值类型的联合类型</li></ul> <p>要想定义更精准的定义类型必须先了解两个类型操作符：<strong>索引类型查询操作符</strong>和<strong>索引访问操作符</strong>。</p> <h3 id="_1-索引类型查询操作符"><a href="#_1-索引类型查询操作符" class="header-anchor">#</a> （1）索引类型查询操作符</h3> <p><code>keyof</code>操作符，连接一个类型，会返回一个由这个类型的所有属性名组成的联合类型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> infoProp<span class="token operator">:</span> keyof Info<span class="token punctuation">;</span>
infoProp <span class="token operator">=</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">;</span>
infoProp <span class="token operator">=</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">;</span>
infoProp <span class="token operator">=</span> <span class="token string">&quot;no&quot;</span><span class="token punctuation">;</span> <span class="token comment">// error 不能将类型“&quot;no&quot;”分配给类型“&quot;name&quot; | &quot;age&quot;”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里的<code>keyof Info</code>其实相当于<code>&quot;name&quot; | “age”</code>。通过和泛型结合使用，TS 就可以检查使用了动态属性名的代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> getValue<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> names<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token comment">// 这里使用泛型，并且约束泛型变量K的类型是&quot;keyof T&quot;，也就是类型T的所有字段名组成的联合类型</span>
  <span class="token keyword">return</span> names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 指定getValue的返回值类型为T[K][]，即类型为T的值的属性值组成的数组</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lison&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> values<span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
values <span class="token operator">=</span> <span class="token function">getValue</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error 不能将类型“number[]”分配给类型“string[]”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>keyof</code> 正是赋予了开发者查询索引类型的能力。</p> <h3 id="_2-索引访问操作符"><a href="#_2-索引访问操作符" class="header-anchor">#</a> （2）索引访问操作符</h3> <p>索引访问操作符也就是<code>[]</code>，其实和我们访问对象的某个属性值是一样的语法，但是在 TS 中它可以用来访问某个属性的类型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type NameType <span class="token operator">=</span> Info<span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> name<span class="token operator">:</span> NameType <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// error 不能将类型“123”分配给类型“string”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>再来看个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> getProperty<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>o<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> o<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// o[name] is of type T[K]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里两个参数的类型分别为泛型 T 和 K，而函数的返回值类型为<code>T[K]</code>，只要函数的返回值也是这种形式，即访问参数 o 的参数 name 属性，即可。</p> <p>再来看个结合接口的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Obj</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> number<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> key<span class="token operator">:</span> keyof Obj<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// keys的类型为number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意，如果索引类型为 number，那么实现该接口的对象的属性名必须是 number 类型；但是如果接口的索引类型是 string 类型，那么实现该接口的对象的属性名设置为数值类型的值也是可以的，因为数值最后还是会先转换为字符串。这里一样，如果接口的索引类型设置为 string 的话，<code>keyof Obj&lt;number&gt;</code>等同于类型<code>number | string</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Obj</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keyof Obj<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// keys的类型为number | string</span>
key <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// right</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>也可以使用访问操作符，获取索引签名的类型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Obj</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> obj<span class="token operator">:</span> Obj<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> value<span class="token operator">:</span> Obj<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// value的类型是number，也就是name的属性值18的类型</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>还有一点，当tsconfig.json里<code>strictNullChecks</code>设为<code>false</code>时，通过<code>Type[keyof Type]</code>获取到的，是除去<code>never &amp; undefined &amp; null</code>这三个类型之后的字段值类型组成的联合类型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Type</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> never<span class="token punctuation">;</span>
  b<span class="token operator">:</span> never<span class="token punctuation">;</span>
  c<span class="token operator">:</span> string<span class="token punctuation">;</span>
  d<span class="token operator">:</span> number<span class="token punctuation">;</span>
  e<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  f<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  g<span class="token operator">:</span> object<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type test <span class="token operator">=</span> Type<span class="token punctuation">[</span>keyof Type<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// test的类型是string | number | object</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里接口 Type 有几个属性，通过索引访问操作符和索引类型查询操作符可以选出类型不为 never &amp; undefined &amp; null 的类型。</p> <p>当了解了这两个访问符之后，最开始的问题就迎刃而解了。</p> <p>首先，需要一个泛型 <code>T</code> 它来代表传入的参数 <code>o</code> 的类型，因为在编写代码时无法确定参数 <code>o</code> 的类型到底是什么，所以在这种情况下要获取 <code>o</code> 的类型必须用面向未来的类型–泛型。</p> <p>那么传入的第二个参数 <code>names</code> ，它的特点就是数组的成员必须由参数 <code>o</code> 的属性名称构成，这个时候我们很容易想到操作符<code>keyof</code>, <code>keyof T</code>代表参数o类型的属性名的联合类型，参数names的成员类型<code>K</code>则只需要约束到<code>keyof T</code>即可。</p> <p>返回值就更简单了，通过类型访问符<code>T[K]</code>便可以取得对应属性值的类型，他们的数组<code>T[K][]</code>正是返回值的类型。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> pick<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>o<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> names<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> names<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">pick</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>用索引类型结合类型操作符完成了 TypeScript 版的 pick 函数，它不仅仅有更严谨的类型约束能力，也提供了更强大的代码提示能力：</p> <p><img src="/assets/img/1607446034618-49be3241-8472-47c1-86fa-fcdfdf7c12fb.dadfcfcd.png" alt="img"></p> <h2 id="_5-映射类型"><a href="#_5-映射类型" class="header-anchor">#</a> 5. 映射类型</h2> <p>现在有一需求，有一个User接口，现在有一个需求是把User接口中的成员全部变成可选的，我们应该怎么做？难道要重新一个个<code>:</code>前面加上<code>?</code>，有没有更便捷的方法？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    username<span class="token operator">:</span> string
    id<span class="token operator">:</span> number
    token<span class="token operator">:</span> string
    avatar<span class="token operator">:</span> string
    role<span class="token operator">:</span> string
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这个时候映射类型就派上用场了，映射类型的语法是<code>[K in Keys]</code>:</p> <ul><li><strong>K</strong>：类型变量，依次绑定到每个属性上，对应每个属性名的类型</li> <li><strong>Keys</strong>：字符串字面量构成的联合类型，表示一组属性名（的类型）</li></ul> <p>首先需要找到<code>Keys</code>，即字符串字面量构成的联合类型，这就得使用上面提到的<code>keyof</code>操作符，假设传入的类型是泛型<code>T</code>，得到<code>keyof T</code>，即传入类型<code>T</code>的属性名的联合类型。</p> <p>然后我们需要将<code>keyof T</code>的属性名称一一映射出来<code>[K in keyof T]</code>，如果要把所有的属性成员变为可选类型，那么需要<code>T[K]</code>取出相应的属性值，最后重新生成一个可选的新类型<code>{ [K in keyof T]?: T[K] }</code>。</p> <p>用类型别名表示就是：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试一下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type partialUser <span class="token operator">=</span> partial<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>所有的属性都变成了可选类型：</p> <p><img src="/assets/img/1607151032839-53abda4d-a51b-4615-8008-967fd134d9a0.b64e66e1.png" alt="img"></p> <h3 id="_1-由映射类型进行推断"><a href="#_1-由映射类型进行推断" class="header-anchor">#</a> （1）由映射类型进行推断</h3> <p>使用映射类型包装一个类型的属性后，也可以进行逆向操作，也就是拆包，先来看包装操作：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Proxy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 这里定义一个映射类型，他将一个属性拆分成get/set方法</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
type Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> Proxy<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 这里再定义一个映射类型，将一个对象的所有属性值类型都变为Proxy&lt;T&gt;处理之后的类型</span>
<span class="token keyword">function</span> proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 这里定义一个proxify函数，用来将对象中所有属性的属性值改为一个包含get和set方法的对象</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> props <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lison&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> proxyProps <span class="token operator">=</span> <span class="token function">proxify</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>proxyProps<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;lison&quot;</span>
proxyProps<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>这里我们定义了一个函数，这个函数可以把传入的对象的每个属性的值替换为一个包含 get 和 set 两个方法的对象。最后我们获取某个值的时候，比如 name，就使用 proxyProps.name.get()方法获取它的值，使用 proxyProps.name.set()方法修改 name 的值。</p> <p>接下来进行拆包：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> unproxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token operator">:</span> Proxify<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">{</span> <span class="token comment">// 这里我们定义一个拆包函数，其实就是利用每个属性的get方法获取到当前属性值，然后将原本是包含get和set方法的对象改为这个属性值</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> k <span class="token keyword">in</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里通过调用属性值这个对象的get方法获取到属性值，然后赋给这个属性，替换掉这个对象</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> originalProps <span class="token operator">=</span> <span class="token function">unproxify</span><span class="token punctuation">(</span>proxyProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_2-增加或移除特定修饰符"><a href="#_2-增加或移除特定修饰符" class="header-anchor">#</a> （2）增加或移除特定修饰符</h3> <p>TS 在 2.8 版本为映射类型增加了增加或移除特定修饰符的能力，使用<code>+</code>和<code>-</code>符号作为前缀来指定增加还是删除修饰符。首先来看如何通过映射类型为一个接口的每个属性增加修饰符，这里使用+前缀：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type ReadonlyInfo<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">+</span>readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> info<span class="token operator">:</span> ReadonlyInfo<span class="token operator">&lt;</span>Info<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lison&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
info<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>经过 ReadonlyInfo 创建的接口类型，属性是可选的，所以在定义 info 的时候没有写 age 属性也没问题，同时每个属性是只读的，所以修改 name 的值的时候报错。通过+前缀增加了 readonly 和?修饰符。当然，增加的时候，这个+前缀可以省略，也就是说，上面的写法和<code>type ReadonlyInfo = { readonly [P in keyof T]?: T[P] }</code>是一样的。</p> <p>删除修饰符：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Info</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>
  age<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type RemoveModifier<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">-</span>readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
type InfoType <span class="token operator">=</span> RemoveModifier<span class="token operator">&lt;</span>Readonly<span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>Info<span class="token operator">&gt;&gt;&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> info1<span class="token operator">:</span> InfoType <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// error missing &quot;age&quot;</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lison&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> info2<span class="token operator">:</span> InfoType <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;lison&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
info2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// right, can edit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这里定义了去掉修饰符的映射类型 RemoveModifier，<code>Readonly&lt;Partial&lt;Info&gt;&gt;</code>则是返回一个既属性可选又只读的接口类型，所以 InfoType 类型则表示属性必含而且非只读。</p> <p>TS 内置了一个映射类型<code>Required&lt;T&gt;</code>，使用它可以去掉 T 所有属性的<code>?</code>修饰符。</p> <h3 id="_3-keyof-和映射类型在-2-9版本的升级"><a href="#_3-keyof-和映射类型在-2-9版本的升级" class="header-anchor">#</a> （3）keyof 和映射类型在 2.9版本的升级</h3> <p>TS 在 2.9 版本中，keyof 和映射类型支持用 number 和 symbol 命名的属性，下面是 keyof 的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numberIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> symbolIndex <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
type Obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>stringIndex<span class="token punctuation">]</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token punctuation">[</span>numberIndex<span class="token punctuation">]</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token punctuation">[</span>symbolIndex<span class="token punctuation">]</span><span class="token operator">:</span> symbol<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
type keys <span class="token operator">=</span> keyof Obj<span class="token punctuation">;</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keys <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keys <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// right</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keys <span class="token operator">=</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keys <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span> <span class="token comment">// right</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keys <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
<span class="token keyword">let</span> key<span class="token operator">:</span> keys <span class="token operator">=</span> symbolIndex<span class="token punctuation">;</span> <span class="token comment">// right</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>再来看映射类型的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> numberIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> symbolIndex <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
type Obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>stringIndex<span class="token punctuation">]</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  <span class="token punctuation">[</span>numberIndex<span class="token punctuation">]</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token punctuation">[</span>symbolIndex<span class="token punctuation">]</span><span class="token operator">:</span> symbol<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
type ReadonlyType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> readonly <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> obj<span class="token operator">:</span> ReadonlyType<span class="token operator">&lt;</span>Obj<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token string">&quot;aa&quot;</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>symbolIndex<span class="token punctuation">]</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token string">&quot;bb&quot;</span><span class="token punctuation">;</span> <span class="token comment">// error Cannot assign to 'a' because it is a read-only property</span>
obj<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span> <span class="token comment">// error Cannot assign to '1' because it is a read-only property</span>
obj<span class="token punctuation">[</span>symbolIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error Cannot assign to '[symbolIndex]' because it is a read-only property</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_4-元组和数组上的映射类型"><a href="#_4-元组和数组上的映射类型" class="header-anchor">#</a> （4）元组和数组上的映射类型</h3> <p>TS 在 3.1 版本中，在元组和数组上的映射类型会生成新的元组和数组，并不会创建一个新的类型，这个类型上会具有 push、pop 等数组方法和数组属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type MapToPromise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
type Tuple <span class="token operator">=</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> string<span class="token punctuation">,</span> boolean<span class="token punctuation">]</span><span class="token punctuation">;</span>
type promiseTuple <span class="token operator">=</span> MapToPromise<span class="token operator">&lt;</span>Tuple<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> tuple<span class="token operator">:</span> promiseTuple <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这里定义了一个MapToPromise映射类型。它返回一个将传入的类型的所有字段的值转为Promise，且Promise的resolve回调函数的参数类型为这个字段类型。定义一个元组Tuple，元素类型分别为number、string和boolean，使用MapToPromise映射类型将这个元组类型传入，并且返回一个promiseTuple类型。当指定变量tuple的类型为promiseTuple后，它的三个元素类型都是一个Promise，且resolve的参数类型依次为number、string和boolean。</p> <h2 id="_6-条件类型"><a href="#_6-条件类型" class="header-anchor">#</a> 6. 条件类型</h2> <h3 id="_1-条件类型基础使用"><a href="#_1-条件类型基础使用" class="header-anchor">#</a> （1）条件类型基础使用</h3> <p>条件类型是 TS 在2.8版本引入的，从语法上看它像是三元操作符。它会以一个条件表达式进行类型关系检测，然后在后面两种类型中选择一个，写法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">U</span> <span class="token operator">?</span> <span class="token constant">X</span> <span class="token operator">:</span> <span class="token constant">Y</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这个表达式的意思是，如果 T 可以赋值给 U 类型，则是 X 类型，否则是 Y 类型。</p> <p>比如，声明一个函数 <code>f</code>，它的参数接收一个布尔类型，当布尔类型为 <code>true</code> 时返回 <code>string</code> 类型,否则返回 <code>number</code> 类型:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>declare <span class="token keyword">function</span> f<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">true</span> <span class="token operator">?</span> string <span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.5</span><span class="token punctuation">)</span>  <span class="token comment">//  x类型： const x： string | number</span>
<span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>                <span class="token comment">//  y类型： const y： number</span>
<span class="token keyword">const</span> z <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>                 <span class="token comment">//  z类型： const z： string</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>条件类型就是这样，只有类型系统中给出充足的条件之后，它才会根据条件推断出类型结果。</p> <h3 id="_2-分布式条件类型"><a href="#_2-分布式条件类型" class="header-anchor">#</a> （2）分布式条件类型</h3> <p>当待检测的类型是联合类型，则该条件类型被称为“分布式条件类型”，在实例化时会自动分发成联合类型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type TypeName<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">any</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> never<span class="token punctuation">;</span>
type Type1 <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span>string <span class="token operator">|</span> number<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Type1的类型是string|number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>再来看个复杂点的例子，这是官方文档的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type TypeName<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">string</span>
  <span class="token operator">?</span> string
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">number</span>
  <span class="token operator">?</span> number
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">boolean</span>
  <span class="token operator">?</span> boolean
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">undefined</span>
  <span class="token operator">?</span> <span class="token keyword">undefined</span>
  <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span>
  <span class="token operator">?</span> Function
  <span class="token operator">:</span> object<span class="token punctuation">;</span>
type Type1 <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Type1的类型是Function</span>
type Type2 <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Type2的类型是object</span>
type Type3 <span class="token operator">=</span> TypeName<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">|</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Type3的类型是object | Function</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>来看一个分布式条件类型的实际应用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Diff<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">U</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">U</span> <span class="token operator">?</span> never <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
type Test <span class="token operator">=</span> Diff<span class="token operator">&lt;</span>string <span class="token operator">|</span> number <span class="token operator">|</span> boolean<span class="token punctuation">,</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> number<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Test的类型为string | boolean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里定义的条件类型的作用就是，找出从 T 中出去 U 中存在的类型，得到剩下的类型。不过这个条件类型已经内置在 TS 中了，只不过它不叫 Diff，叫 Exclude。</p> <p>来看一个条件类型和映射类型结合的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token operator">:</span> never <span class="token punctuation">}</span><span class="token punctuation">[</span>keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">Part</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> number<span class="token punctuation">;</span>
  name<span class="token operator">:</span> string<span class="token punctuation">;</span>
  subparts<span class="token operator">:</span> Part<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">updatePart</span><span class="token punctuation">(</span>newName<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type Test <span class="token operator">=</span> Type<span class="token operator">&lt;</span>Part<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// Test的类型为&quot;updatePart&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个例子中，接口 Part 有四个字段，其中 updatePart 的值是函数，也就是 Function 类型。Type的定义中，涉及到映射类型、条件类型、索引访问类型和索引类型。首先[K in keyof T]用于遍历 T 的所有属性名，值使用了条件类型，T[K]是当前属性名的属性值，<code>T[K] extends Function ? K : never</code>表示如果属性值为 Function 类型，则值为属性名字面量类型，否则为 never 类型。接下来使用<code>keyof T</code>获取 T 的属性名，最后通过索引访问类型<code>[keyof T]</code>获取不为 never 的类型。</p> <h3 id="_3-条件类型的类型推断-infer"><a href="#_3-条件类型的类型推断-infer" class="header-anchor">#</a> （3）条件类型的类型推断-infer</h3> <p>条件类型提供一个<code>infer</code>关键字用来推断类型。我们想定义一个条件类型，如果传入的类型是一个数组，则返回它元素的类型；如果是一个普通类型，则直接返回这个类型。不使用 infer可以这样写：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">?</span> <span class="token constant">T</span><span class="token punctuation">[</span>number<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
type test <span class="token operator">=</span> Type<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// test的类型为string</span>
type test2 <span class="token operator">=</span> Type<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// test2的类型为string</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果传入 Type 的是一个数组类型，那么返回的类型为<code>T[number]</code>，也就是该数组的元素类型，如果不是数组，则直接返回这个类型。这里通过索引访问类型<code>T[number]</code>来获取类型的，如果使用 infer 关键字则无需自己手动获取，来看下怎么使用 infer：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span><span class="token operator">&lt;</span>infer <span class="token constant">U</span><span class="token operator">&gt;</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
type test <span class="token operator">=</span> Type<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// test的类型为string</span>
type test2 <span class="token operator">=</span> Type<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// test2的类型为string</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这里 infer 能够推断出 U 的类型，并且供后面使用，可以理解为这里定义了一个变量 U 来接收数组元素的类型。</p> <h3 id="_4-预定义条件类型"><a href="#_4-预定义条件类型" class="header-anchor">#</a> （4）预定义条件类型</h3> <p>TS 在 2.8 版本增加了一些预定义的有条件类型，来看一下：</p> <ul><li><strong>Exclude&lt;T, U&gt;，从 T 中去掉可以赋值给 U 的类型：</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span><span class="token string">&quot;a&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;b&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;b&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Type =&gt; 'c'</span>
type Type2 <span class="token operator">=</span> Exclude<span class="token operator">&lt;</span>string <span class="token operator">|</span> number <span class="token operator">|</span> boolean<span class="token punctuation">,</span> string <span class="token operator">|</span> number<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Type2 =&gt; boolean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>Extract&lt;T, U&gt;，选取 T 中可以赋值给 U 的类型：</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type <span class="token operator">=</span> Extract<span class="token operator">&lt;</span><span class="token string">&quot;a&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;b&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;c&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;f&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Type =&gt; 'a' | 'c'</span>
type Type2 <span class="token operator">=</span> Extract<span class="token operator">&lt;</span>number <span class="token operator">|</span> string <span class="token operator">|</span> boolean<span class="token punctuation">,</span> string <span class="token operator">|</span> boolean<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Type2 =&gt; string | boolean</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>NonNullable，从 T 中去掉 null 和 undefined：</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type <span class="token operator">=</span> Extract<span class="token operator">&lt;</span>string <span class="token operator">|</span> number <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// Type =&gt; string | number</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>ReturnType，获取函数类型返回值类型：</strong></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Type <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> string<span class="token punctuation">)</span><span class="token operator">&gt;</span>
<span class="token comment">// Type =&gt; string</span>
type Type2 <span class="token operator">=</span> ReturnType<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>
<span class="token comment">// Type2 =&gt; void</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>InstanceType，获取构造函数类型的实例类型：</strong></li></ul> <p>先来看下InstanceType的实现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type InstanceType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">new</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token operator">...</span>args<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> infer <span class="token constant">R</span>
  <span class="token operator">?</span> <span class="token constant">R</span>
  <span class="token operator">:</span> any<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>InstanceType 条件类型要求泛型变量 T 类型是创建实例为 any 类型的构造函数，而它本身则通过判断 T 是否是构造函数类型来确定返回的类型。如果是构造函数，使用 infer 可以自动推断出 R 的类型，即实例类型；否则返回的是 any 类型。</p> <p>再来看下InstanceType 的使用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
type <span class="token constant">T1</span> <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> <span class="token constant">A</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// T1的类型为A</span>
type <span class="token constant">T2</span> <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// T2的类型为any</span>
type <span class="token constant">T3</span> <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span>never<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// T3的类型为never</span>
type <span class="token constant">T4</span> <span class="token operator">=</span> InstanceType<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// error</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在T1 的定义中，<code>typeof A</code>返回的的是类 A 的类型，也就是 A，这里不能使用 A 因为它是值不是类型，类型 A 是构造函数，所以 T1 是 A 构造函数的实例类型，也就是 A；T2 传入的类型为 any，因为 any 是任何类型的子类型，所以它满足<code>T extends new (…args: any[]) =&gt; infer R</code>，这里 infer 推断的 R 为 any；传入 never 和 any 同理。传入 string 时因为 string 不能不给构造函数类型，所以报错。</p> <h3 id="_5-条件类型与映射类型"><a href="#_5-条件类型与映射类型" class="header-anchor">#</a> （5）条件类型与映射类型</h3> <p>思考题: 有一个interface <code>Part</code>。现在需要编写一个工具类型将interface中<strong>函数类型</strong>的<strong>名称</strong>取出来，在这个题目示例中，应该取出的是:</p> <p><img src="/assets/img/1607151049347-20502cc3-8550-4860-bee6-23c2ef6ec7b9.720bb6d5.png" alt="img"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Part</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> number<span class="token punctuation">;</span>
    name<span class="token operator">:</span> string<span class="token punctuation">;</span>
    subparts<span class="token operator">:</span> Part<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">updatePart</span><span class="token punctuation">(</span>newName<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type <span class="token constant">R</span> <span class="token operator">=</span> FunctionPropertyNames<span class="token operator">&lt;</span>Part<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>那该如何设计这个工具类型?这种问题我们应该换个思路，比如把interface看成js中的对象字面量，用js的思维只要遍历整个对象，找出value是函数的部分取出key即可.</p> <p>在TypeScript的类型编程中也是类似的道理，要遍历interface，取出类型为<code>Function</code>的部分找出key即可:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type FunctionPropertyNames<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> keyof <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token keyword">extends</span> <span class="token class-name">Function</span> <span class="token operator">?</span> <span class="token constant">K</span> <span class="token operator">:</span> never <span class="token punctuation">}</span><span class="token punctuation">[</span>keyof <span class="token constant">T</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下面来一步步分析一下上述工具类型：</p> <ol><li><p>假设把<code>Part</code>代入泛型<code>T</code>，<code>[K in keyof T]</code>相当于遍历整个interface</p></li> <li><p>这时<code>K</code>相当于interface的key，<code>T[K]</code>相当于interface的value</p></li> <li><p>接下来，用条件类型验证value的类型，如果是<code>Function</code>那么将value作为新interface的key保留下来,否则为<code>never</code></p></li> <li><p>到这里我们得到了遍历修改后的<strong>新</strong>interface:</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type <span class="token constant">R</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> never<span class="token punctuation">;</span>
    name<span class="token operator">:</span> never<span class="token punctuation">;</span>
    subparts<span class="token operator">:</span> never<span class="token punctuation">;</span>
    updatePart<span class="token operator">:</span> <span class="token string">&quot;updatePart&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>特别注意:</strong> 这里产生的新interface R中的value是老interface Part的key,取出新interface R的value就是取出了对应老interface Part的key。</p> <p>但是要求的是取出老interface Part的key，这个时候再次用<code>[keyof T]</code>作为key依次取出新interface的value，但是由于<code>id</code> <code>name</code>和<code>subparts</code>的value为<code>never</code>就不会返回任何类型了，所以只返回了<code>'updatePart'</code>.</p> <h2 id="_7-可辨识联合类型"><a href="#_7-可辨识联合类型" class="header-anchor">#</a> 7. 可辨识联合类型</h2> <p>我们可以把单例类型、联合类型、类型保护和类型别名这几种类型进行合并，来创建一个叫做<strong>可辨识联合</strong>的高级类型，它也可称作<strong>标签联合</strong>或<strong>代数数据类型</strong>。</p> <p>所谓单例类型，可以理解为符合单例模式的数据类型，比如枚举成员类型，字面量类型。</p> <p>可辨识联合要求具有两个要素：</p> <ul><li>具有普通的单例类型属性（这个要作为辨识的特征，也是重要因素）。</li> <li>一个类型别名，包含了那些类型的联合（即把几个类型封装为联合类型，并起一个别名）。</li></ul> <p><strong>可辨识联合类型就是为了保证每个case都能被处理。</strong></p> <p>来看一个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Square</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;square&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 这个就是具有辨识性的属性</span>
  size<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;rectangle&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 这个就是具有辨识性的属性</span>
  height<span class="token operator">:</span> number<span class="token punctuation">;</span>
  width<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;circle&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 这个就是具有辨识性的属性</span>
  radius<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type Shape <span class="token operator">=</span> Square <span class="token operator">|</span> Rectangle <span class="token operator">|</span> Circle<span class="token punctuation">;</span> <span class="token comment">// 这里使用三个接口组成一个联合类型，并赋给一个别名Shape，组成了一个可辨识联合。</span>
<span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> Shape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;square&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;rectangle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;circle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>上面这个例子中，我们的 Shape 即可辨识联合，它是三个接口的联合，而这三个接口都有一个 kind 属性，且每个接口的 kind 属性值都不相同，能够起到标识作用。 函数内应该包含联合类型中每一个接口的 case。</p> <p>如果函数内没有包含联合类型中每一个接口的 case。但是如果遗漏了，就希望编译器应该给出提示。有以下两种<strong>完整性检查</strong>的方法：<strong>利用 strictNullChecks</strong>和<strong>使用 never 类型</strong>。</p> <h3 id="_1-利用-strictnullchecks"><a href="#_1-利用-strictnullchecks" class="header-anchor">#</a> （1）利用 strictNullChecks</h3> <p>对上面的例子加一种接口：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">interface</span> <span class="token class-name">Square</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;square&quot;</span><span class="token punctuation">;</span>
  size<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;rectangle&quot;</span><span class="token punctuation">;</span>
  height<span class="token operator">:</span> number<span class="token punctuation">;</span>
  width<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Circle</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;circle&quot;</span><span class="token punctuation">;</span>
  radius<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Triangle</span> <span class="token punctuation">{</span>
  kind<span class="token operator">:</span> <span class="token string">&quot;triangle&quot;</span><span class="token punctuation">;</span>
  bottom<span class="token operator">:</span> number<span class="token punctuation">;</span>
  height<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
type Shape <span class="token operator">=</span> Square <span class="token operator">|</span> Rectangle <span class="token operator">|</span> Circle <span class="token operator">|</span> Triangle<span class="token punctuation">;</span> <span class="token comment">// 这里我们在联合类型中新增了一个接口，但是下面的case却没有处理Triangle的情况</span>
<span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> Shape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;square&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;rectangle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;circle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>这里，Shape 联合有四种接口，但函数的 switch 里只包含三个 case，这个时候编译器并没有提示任何错误，因为当传入函数的是类型是 Triangle 时，没有任何一个 case 符合，则不会有 return 语句执行，那么函数是默认返回 undefined。所以我们可以利用这个特点，结合 strictNullChecks编译选项，可以开启 strictNullChecks，然后让函数的返回值类型为 number，那么当返回 undefined 的时候，就会报错：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> Shape</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token comment">// error Function lacks ending return statement and return type does not include 'undefined'</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;square&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;rectangle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;circle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这种方法简单，但是对旧代码支持不好，因为strictNullChecks这个配置项是2.0版本才加入的，如果使用的是低于这个版本的，这个方法并不会有效。</p> <h3 id="_2-使用-never-类型"><a href="#_2-使用-never-类型" class="header-anchor">#</a> （2） 使用 never 类型</h3> <p>当函数返回一个错误或者不可能有返回值的时候，返回值类型为 never。所以可以给 switch 添加一个 default 流程，当前面的 case 都不符合的时候，会执行 default 后的逻辑：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">assertNever</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> never</span><span class="token punctuation">)</span><span class="token operator">:</span> never <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected object: &quot;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getArea</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token operator">:</span> Shape</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&quot;square&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>size <span class="token operator">*</span> s<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;rectangle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> s<span class="token punctuation">.</span>height <span class="token operator">*</span> s<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token string">&quot;circle&quot;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>radius <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">assertNever</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// error 类型“Triangle”的参数不能赋给类型“never”的参数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>采用这种方式，需要定义一个额外的 asserNever 函数，但是这种方式不仅能够在编译阶段提示我们遗漏了判断条件，而且在运行时也会报错。</p> <h2 id="_8-this类型"><a href="#_8-this类型" class="header-anchor">#</a> 8. this类型</h2> <p>在 JavaScript 中，this 可以用来获取对全局对象、类实例对象、构建函数实例等的引用，在 TypeScript 中，this 也是一种类型。先来看个计算器 Counter 的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> count<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义一个相加操作的方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">+=</span> value<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义一个相减操作的方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">-=</span> value<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10</span>
counter<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 13</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这里给 Counter 类定义几个方法，每个方法都返回 this，这个 this 即指向实例，这样就可以通过链式调用的形式来使用这些方法。这个是没有问题的，但是如果要通过类继承的形式丰富这个 Counter 类，添加一些方法，依然返回 this，然后采用链式调用的形式调用，在过去版本的 TypeScript 中是有问题的，先来看继承的逻辑：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">PowCounter</span> <span class="token keyword">extends</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">public</span> count<span class="token operator">:</span> number <span class="token operator">=</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">pow</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 定义一个幂运算操作的方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">**</span> value<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> powcounter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PowCounter</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
powCounter
  <span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>powCounter<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>我们定义了 PowCounter 类，它继承 Counter 类，新增了 pow 方法用来求值的幂次方，这里使用了 ES7 新增的幂运算符<code>**</code>。我们使用 PowCounter 创建了实例 powcounter，它的类型自然是 PowCounter，在该实例上调用继承来的 subtract 和 add 方法。如果是在过去，就会报错，因为创建实例 powcounter 的类 PowCounter 没有定义这两个方法，所以会报没有这两个方法的错误。但是在 1.7 版本中增加了 this 类型，TypeScript 会对方法返回的 this 进行判断，就不会报错了。</p> <p>对于对象来说，对象的属性值可以是一个函数，那么这个函数也称为方法，在方法内如果访问this，默认情况下是对这个对象的引用，this类型也就是这个对象的字面量类型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'Lison'</span><span class="token punctuation">,</span>
  <span class="token function">getName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token comment">// &quot;Lison&quot; 这里this的类型为 { name: string; getName(): string; }</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>但是如果显式地指定了this的类型，那么this的类型就改变了，如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;Lison&quot;</span><span class="token punctuation">,</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> number <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 这里的this的类型是{ age: number }</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果在 tsconfig.json 里将 noImplicitThis 设为 true，这时候有两种不同的情况：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">**</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 对象字面量具有 ThisType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> 指定的类型，此时 <span class="token keyword">this</span> 的类型为 <span class="token constant">T</span>：<span class="token operator">**</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>type ObjectDescriptor<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 使用类型别名定义一个接口，这里用了泛型，两个泛型变量D和M</span>
  data<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">D</span><span class="token punctuation">;</span> <span class="token comment">// 这里指定data为可选字段，类型为D</span>
  <span class="token comment">// 这里指定methods为可选字段，类型为M和ThisType&lt;D &amp; M&gt;组成的交叉类型；  </span>
  <span class="token comment">// ThisType是一个内置的接口，用来在对象字面量中键入this，这里指定this的类型为D &amp; M  </span>
  methods<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">M</span> <span class="token operator">&amp;</span> ThisType<span class="token operator">&lt;</span><span class="token constant">D</span> <span class="token operator">&amp;</span> <span class="token constant">M</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
<span class="token comment">// 这里定义一个mackObject函数，参数desc的类型为ObjectDescriptor&lt;D, M&gt;</span>
<span class="token keyword">function</span> makeObject<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>desc<span class="token operator">:</span> ObjectDescriptor<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">D</span> <span class="token operator">&amp;</span> <span class="token constant">M</span> <span class="token punctuation">{</span> 
  <span class="token keyword">let</span> data<span class="token operator">:</span> object <span class="token operator">=</span> desc<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> methods<span class="token operator">:</span> object <span class="token operator">=</span> desc<span class="token punctuation">.</span>methods <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 这里通过...操作符，将data和methods里的所有属性、方法都放到了同一个对象里返回，这个对象的类型自然就      是D &amp; M，因为他同时包含D和M两个类型的字段  </span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data<span class="token punctuation">,</span> <span class="token operator">...</span>methods <span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">D</span> <span class="token operator">&amp;</span> <span class="token constant">M</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">makeObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 这里data的类型就是我们上面定义ObjectDescriptor&lt;D, M&gt;类型中的D</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 这里methods的类型就是我们上面定义ObjectDescriptor&lt;D, M&gt;类型中的M</span>
    <span class="token function">moveBy</span><span class="token punctuation">(</span><span class="token parameter">dx<span class="token operator">:</span> number<span class="token punctuation">,</span> dy<span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+=</span> dx<span class="token punctuation">;</span>  <span class="token comment">// 所以这里的this是我们通过ThisType&lt;D &amp; M&gt;指定的，this的类型就是D &amp; M</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+=</span> dy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">moveBy</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">**</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> 不包含 ThisType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> 指定的上下文类型，那么此时 <span class="token keyword">this</span> 具有上下文类型，也就是普通的情况。<span class="token operator">**</span>

把上面使用了 ThisType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> 的例子中，ObjectDescriptor<span class="token operator">&lt;</span><span class="token constant">D</span><span class="token punctuation">,</span> <span class="token constant">M</span><span class="token operator">&gt;</span>类型中指定methods的类型中的 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&amp; ThisType&lt;D &amp; M&gt;</span><span class="token template-punctuation string">`</span></span> 去掉，会发现 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">moveBy</span><span class="token template-punctuation string">`</span></span> 方法中 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">this.x</span><span class="token template-punctuation string">`</span></span> 和 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">this.y</span><span class="token template-punctuation string">`</span></span> 报错了，因为此时 <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">this</span><span class="token template-punctuation string">`</span></span> 的类型是<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">methods</span><span class="token template-punctuation string">`</span></span> 这个对象字面量的类型。

### 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_9-类型别名"><a href="#_9-类型别名" class="header-anchor">#</a> 9. 类型别名</h2> <p>最后补充一个知识点：类型别名。</p> <p>类型别名就是给一种类型起个新的名字，之后只要使用这个类型的地方，都可以用这个名字作为类型代替，但是它只是起了一个名字，并不是创建了一个新类型。</p> <p>可以使用 <code>type</code> 关键字来定义类型别名：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type some <span class="token operator">=</span> boolean <span class="token operator">|</span> string
<span class="token keyword">const</span> b<span class="token operator">:</span> some <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// ok</span>
<span class="token keyword">const</span> c<span class="token operator">:</span> some <span class="token operator">=</span> <span class="token string">'hello'</span> <span class="token comment">// ok</span>
<span class="token keyword">const</span> d<span class="token operator">:</span> some <span class="token operator">=</span> <span class="token number">123</span> <span class="token comment">// 不能将类型“123”分配给类型“some”</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>类型别名也可以使用泛型：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type PositionType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span> y<span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> position1<span class="token operator">:</span> PositionType<span class="token operator">&lt;</span>number<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  y<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> position2<span class="token operator">:</span> PositionType<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  x<span class="token operator">:</span> <span class="token string">&quot;right&quot;</span><span class="token punctuation">,</span>
  y<span class="token operator">:</span> <span class="token string">&quot;left&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用类型别名时也可以在属性中引用自己：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Child<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  current<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>
  child<span class="token operator">?</span><span class="token operator">:</span> Child<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> ccc<span class="token operator">:</span> Child<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  current<span class="token operator">:</span> <span class="token string">&quot;first&quot;</span><span class="token punctuation">,</span>
  child<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// error</span>
    current<span class="token operator">:</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span>
    child<span class="token operator">:</span> <span class="token punctuation">{</span>
      current<span class="token operator">:</span> <span class="token string">&quot;third&quot;</span><span class="token punctuation">,</span>
      child<span class="token operator">:</span> <span class="token string">&quot;test&quot;</span> <span class="token comment">// 这个地方不符合type，造成最外层child处报错</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>但注意，只可以在对象属性中引用类型别名自己，不能直接使用，比如下面这样是不对的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Child <span class="token operator">=</span> Child<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// error 类型别名“Child”循环引用自身</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>另外要注意，因为类型别名只是为其它类型起了个新名字来引用这个类型，所以当它为接口起别名时，不能使用 <code>extends</code> 和 <code>implements</code> 。</p> <p>接口和类型别名有时可以起到同样作用：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Alias <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">Interface</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> _alias<span class="token operator">:</span> Alias <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span> <span class="token number">123</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> _interface<span class="token operator">:</span> Interface <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token operator">:</span> <span class="token number">321</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
_alias <span class="token operator">=</span> _interface<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>可以看到用类型别名和接口都可以定义一个只包含 num 属性的对象类型，而且类型是兼容的。</p> <p><strong>那****应该如何区分类型别名和接口这两者呢？</strong></p> <p>interface 只能用于定义对象类型，而 type 的声明方式除了对象之外还可以定义交叉、联合、原始类型等，类型声明的方式适用范围显然更加广泛。</p> <p>但是interface也有其特定的用处：</p> <ul><li>interface 方式可以实现接口的 extends 和 implements</li> <li>interface 可以实现接口合并声明</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type Alias <span class="token operator">=</span> <span class="token punctuation">{</span> num<span class="token operator">:</span> number <span class="token punctuation">}</span>
<span class="token keyword">interface</span> <span class="token class-name">Interface</span> <span class="token punctuation">{</span>
    num<span class="token operator">:</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
declare <span class="token keyword">function</span> <span class="token function">aliased</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token operator">:</span> Alias</span><span class="token punctuation">)</span><span class="token operator">:</span> Alias<span class="token punctuation">;</span>
declare <span class="token keyword">function</span> <span class="token function">interfaced</span><span class="token punctuation">(</span><span class="token parameter">arg<span class="token operator">:</span> Interface</span><span class="token punctuation">)</span><span class="token operator">:</span> Interface<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>此外，接口创建了一个新的名字，可以在其它任何地方使用，类型别名并不创建新名字，比如,错误信息就不会使用别名（提示的还是原来的名字）。</p> <p><strong>那么什么时候用类型别名，什么时候用接口呢：</strong></p> <ul><li>**接口：**当定义的类型要用于拓展，即使用 implements 等修饰符时，用接口。</li> <li>**类型别名：**当无法通过接口，并且需要使用联合类型或元组类型，用类型别名。</li></ul></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/docs/advanced/typeScript/compatibility.html" class="prev">
            TypeScript类型兼容性
          </a></span> <span class="next"><a href="/docs/advanced/typeScript/decorator.html">
            TypeScript装饰器
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:0;" data-v-70334359></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:290px;display:none;" data-v-5775ee02>
      欢迎欢迎
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:;" data-v-5775ee02></i></div> <canvas id="banniang" width="260px" height="320" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div><!----><!----><canvas id="vuepress-canvas-cursor"></canvas><!----><div class="RibbonAnimation"></div></div></div>
    <script src="/assets/js/app.50b0bd0e.js" defer></script><script src="/assets/js/6.e87d9ed0.js" defer></script><script src="/assets/js/1.ec164ee9.js" defer></script><script src="/assets/js/44.c67cec05.js" defer></script>
  </body>
</html>
